# OSI模型和TCP/IP模型
## OSI七层模型（Open System Interconnect）
即开放系统互连参考模型，是由ISO（International Organization for Standardization）国际标准化组织提出的，用于计算机或通信系统间互联的标准体系。

从上到下可分为七层：每一层都完成特定的功能，并为上一层提供服务，并使用下层所提供的服务。

7、应用层（Application）：为用户的应用程序提供网络服务
6、表示层（Presentation）：将信息表示为一定形式和格式的数据流
5、会话层（Session）：负责通信主机之间会话的建立、管理和拆除，协调通信双方的会话
4、传输层（Transport）：负责通信主机间端到端的连接
3、网络层（Network）：负责将分组从源机送到目的机，包括寻址和最优路径选择等
2、数据链路层（Data Link）：提供可靠的帧传递，实现差错控制、流控等等
1、物理层（Physical）：提供透明的比特流（01流）传递

## TCP/IP四层参考模型
从上到下可分为四层：
4、应用层（Application）：为用户提供所需要的各种服务
3、传输层（Transport）：为应用层实体提供端到端的通信功能，保证了数据包的顺序传送及数据的完整性
2、网际层（Internet）：主要解决主机到主机的通信问题
1、网络接口层（Network Access）：负责监视数据在主机和网络之间的交换

# 传输层
## TCP三次握手和四次挥手
### 三次握手（建立连接）：  
* 第一次握手：客户端主机向服务器发送一个特殊的TCP报文段，该报文段不包含应用层数据，但是在报文段的首部中的SYN标志位置为1，代表请求建立连接，称为SYN报文段。客户端随机选择一个初始序号，并将此编号放在SYN报文段的序号字段。该报文段被封装在一个网络层数据报中，发送给服务器。
* 第二次握手：服务器接收到包含SYN报文段的IP数据报，提取出SYN报文段，并向客户TCP发送允许连接的报文段。该报文段也不包含应用层数据，SYN标志位置和ACK标志位置均为1，确认号字段为SYN报文段的编号+1，服务器选择主机的初始序号，并将其放置到TCP报文段首部的序号字段。这个报文段被称为SYNACK报文段。
* 第三次握手：客户端收到SYNACK报文段后，也要给该连接分配缓存和变量。同时再向服务器发送另外一个报文段，ACK标志位置为1，确认号为第二次握手服务端发送的序号+1，对SYNACK报文段给以确认，这个报文段包含了应用层数据。

三次握手的原因：  
* 双方能确知对方的存在
* 允许双方协商一些参数
* 对运输实体资源进行分配

拓展知识：  
因为第二次握手（还没有正式开始传送数据）时，服务器就已经给TCP连接分配了缓存资源，这为经典的DoS攻击即SYN洪泛攻击（SYN flood attack）提供了环境。在这种攻击中，攻击者发送大量的TCP SYN报文段，而不完成第三次握手的步骤。随着这种SYN报文段纷至沓来，服务器不断为这些半开连接分配资源（但从未使用），导致服务器的连接资源被消耗殆尽。这种SYN洪泛攻击是被记载的众多DoS攻击中的第一种。

![三次握手过程](https://s2.ax1x.com/2019/05/27/VVs7cT.png)
#### 为什么必须三次握手而不是两次
##### 1. 避免历史连接浪费资源
如果不采用三次握手，而是两次握手，可能会出现这种情况：
客户端向服务器发起一个连接建立请求，但滞留在网络中未到达，于是重发了一个请求，这个请求到达了，并成功建立起连接，传输数据完毕后释放连接。之后之前滞留在网络中的请求到达了服务器，服务器误以为是新建立了一个连接，并发送了数据，而客户端实际上并不需要传输，于是服务器分配的资源被白白浪费了。而如果是三次握手，那么第二次握手时不分配资源，只是发送SYNACK报文，之后

###### RST报文
用于复位因某种原因引起出现的错误连接，也用来拒绝非法数据和请求。

1. 如果是历史连接（序列号过期或超时），则第三次握手发送的报文是 RST 报文，以此中止历史连接；
2. 如果不是历史连接，则第三次发送的报文是 ACK 报文，通信双方就会成功建立连接；
##### 2. 同步双方初始序列号TCP 
协议的通信双方， 都必须维护一个「序列号」， 序列号是可靠传输的一个关键因素，它的作用：接收方可以去除重复的数据；接收方可以根据数据包的序列号按序接收；可以标识发送出去的数据包中， 哪些是已经被对方收到的；可见，序列号在 TCP 连接中占据着非常重要的作用，所以当客户端发送携带「初始序列号」的 SYN 报文的时候，需要服务端回一个 ACK 应答报文，表示客户端的 SYN 报文已被服务端成功接收，那当服务端发送「初始序列号」给客户端的时候，依然也要得到客户端的应答回应，这样一来一回，才能确保双方的初始序列号能被可靠的同步。




### 四次挥手（连接释放）
**客户端和服务器都可以发起**

客户端向服务器发送一个特殊的TCP报文段，该报文段FIN标志位置为1。服务器收到后，给发送方回送一个确认报文段，ACK标志位为0。之后服务器可以继续发送一些尚未发送完毕的数据，发送完毕后，服务器发送它自己的终止报文段，其FIN比特被置为1.最后，客户端对服务器的终止报文段进行确认。

![连接释放过程](https://s2.ax1x.com/2019/05/27/VVsT3V.png)

# 应用层

## HTTPS过程
1. 客户端生成一个随机数（随机数1）并将随机数和支持的加密套件发给服务端
2. 服务端选择加密套件，同时也生成一个随机数（随机数2），并将选择的加密套件、随机数2和CA证书发送给客户端
3. 客户端验证CA证书是否有效，如果有效，提取出证书中的公钥，生成一个新随机数3（预主密钥），并使用服务端公钥对预主密钥加密，发送给服务端
4. 服务端使用自己的私钥解密出预主密钥
5. 客户端和服务端结合随机数1、随机数2、预主密钥使用相同的算法生成一个会话密钥，用于业务信息的对称加密

### 证书的验证过程
服务端将公钥和站点信息等交给CA，CA审核通过后，颁发一个包含公钥、站点信息等明文信息和数字签名的证书。数字签名是通过对站点的明文信息使用特定的哈希函数进行计算并使用CA的私钥加密得到的。

客户端的浏览器内置了各大CA机构的公钥，在验证证书时，使用相同的哈希函数对证书的明文信息进行计算，得到哈希值1，再使用CA的公钥对证书的数字签名解密得到哈希值2，最后比较哈希值1和哈希值2，如果一致，则说明证书是可信的。

## HTTPS端口号
443

## HTTP状态码
* 1xx：请求还在处理中
* 2xx：处理成功的请求
    * 200 OK：不管什么请求方式(GET, POST, PUT, DELETE, HEAD...)，请求没问题
    * 201 Created：已创建一个新资源（主要针对PUT和POST）
    * 204 No Content：请求成功，但没有响应内容
* 3xx：重定向，资源被移去其他地方
    * 301 Moved Permanently：永久移动
    * 302 Found：暂时移动
    * 304 Not Modified：服务器资源未修改，直接使用本地缓存的内容
* 4xx：客户端问题
    * 400 Bad request：请求错误，无法理解
    * 401 Unauthorized：缺乏目标资源要求的身份验证凭证
    * 403 Forbidden：服务器端有能力处理该请求，但是拒绝授权访问
    * 404 Not Found：服务器无法找到所请求的资源
* 5xx：服务端问题
    * 500 Internal Server Error：服务端内部错误
    * 502 Bad Gateway：网关错误
    * 503 Service Unavailable：服务器尚未处于可以接受请求的状态。通常造成这种情况的原因是由于服务器停机维护或者已超载