# 基本知识
## 网络协议组成要素
* **语法**
* **语义**
* **同步**

## 通信知识
### 分组交换
#### 传输方式
* 虚电路
* 数据报

#### 时延
##### 类型
* 结点处理时延
* 排队时延
* 传输时延
* 传播时延

##### 计算
$$d_{nodal}=d_{proc}+d_{queue}+d_{trans}+d_{prop}$$

##### 存储转发和直接转发的区别
* 存储转发需要收到一个完整的帧再发送，慢
* 直接转发收到数据就发送，快

#### 分组丢失
分组到达速度大于发送速度，分组缓存容量有限，超出容量就会造成丢失

### 电路交换
#### 实现方式
* FDM（频分）
* TDM（时分）
* CDMA（码分）

# 应用层
## 协议数据单元（PDU）
**message**，中文称报文、消息

## 协议
* HTTP(超文本传输协议)
    Web
* FTP(文件传输协议)
    传输文件
* SMTP(简单邮件传输协议)
    传输邮件
* POP3
    查看邮件
* IMAP
    查看邮件
* DNS（域名系统）
    * 查找域名对应的IP地址
        * 迭代查询
        * 递归查询
    * 根DNS服务器
    * 顶级域DNS服务器
    * 权威DNS服务器
    * 本地DNS服务器

# 传输层（运输层）
## 协议数据单元（PDU）
**segment**，中文称报文段、分组、数据段等等
## 协议
### TCP（传输控制协议）
#### TCP报文段结构
* 标志字段
    * **ACK**
    * **SYN**
    * **FIN**
* 序号和确认号
    * TCP提供累积确认

#### 往返时间(RTT)的估计和超时
##### 估计往返时间
新的估计往返时间等于旧的估计往返时间和新的测量时间以一定比例相加
仅在某个时刻做一次测量，且不为重传的报文段测量RTT，只为传送一次的报文段测量
###### 公式
RTT估算：
$$EstimatedRTT(RTT_s)=(1-\alpha)\times EstimatedRTT+\alpha \times SampleRTT$$
α推荐为0.125

RTT变化程度:
$$DevRTT(RTT_D)=(1-\beta)\times DevRTT+\beta\times |SampleRTT-EstimatedRTT|$$

##### 设置重传超时间隔（Karn算法）
$$RTO(TimeoutInteval)=EstimatedRTT+4\times DevRTT$$
如果重传，RTO=2*RTO

#### 功能
##### 可靠数据传输
###### 快速重传
* 接收方
    每收到一个失序报文段，立即发送一个对上一个按序到达报文的重复确认（ACK）
* 发送方
    一旦受到3个冗余ACK，直接重发对方要求的报文段，不过重传计时器依然有效
###### 特点
* 发送和接受窗口不一定一样大
* TCP标准没有规定不按序到达的数据如何处理
* TCP要求接收方必须有累积确认的功能

##### 流量控制
发送方不能淹没接收方缓存

接受窗口rwnd

利用滑动窗口实现流量控制

##### 拥塞控制
###### 和流量控制的区别
拥塞控制针对全网，流量控制针对一对一连接

###### 状态变量
* 拥塞窗口cwnd
* 慢启动阈值ssthresh

###### 拥塞的影响
* 时延变大
* 丢包

###### 方法
* 满开始和拥塞避免
发送方维持一个叫做拥塞窗口（cwnd）的状态变量。拥塞窗口的大小取决于拥塞程度，动态变化。发送方让发送窗口等于拥塞窗口。开始拥塞窗口的值设置为一个最大报文段（MSS）的数值，记为1。如果没有出现拥塞，每经过一个传输轮次，cwnd变为原来的两倍。为了防止过快增加，设置了慢开始门限状态变量（ssthresh）。当检测到超时时，将ssthresh设为原先cwnd的一半，将cwnd置为1，重新开始慢启动，这个过程中当cwnd的大小等于ssthresh时，执行拥塞避免策略，每次cwnd的大小只增加1.
* 快重传和快恢复
快速重传的策略已经在图中有解释。当发送方接收到3个冗余ACK时（但并没有超时），TCP对于这种事件反应没有超时那么激烈，此时执行快速恢复策略：将ssthresh设为原先cwnd的一半，再将cwnd的值减半，之后每次发送时cwnd的值再增加1。  
一种称为TCP Tahoe的TCP早期版本没有快速恢复策略，不管是超时还是收到3个冗余ACK，均采用慢开始策略。而较新版本的TCP Reno，则综合了快速恢复。两者的区别如下图：
![快速恢复](https://s2.ax1x.com/2019/04/22/EkOay8.png)

#### TCP连接管理